<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®ºå› - æˆ‘çš„ä¸–ç•ŒæœåŠ¡å™¨</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .forum-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .forum-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .new-post-btn {
            background: #4CAF50;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .new-post-btn:hover {
            background: #45a049;
        }
        
        .forum-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .category-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 10px;
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .category-card h3 {
            color: #4CAF50;
            margin-bottom: 1rem;
        }
        
        .category-card p {
            color: #fff;
            margin-bottom: 1rem;
        }

        .post-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .post-item {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .post-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .post-info {
            flex: 1;
        }

        .post-title {
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            text-decoration: none;
            display: block;
        }

        .post-title:hover {
            color: #4CAF50;
        }

        .post-meta {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .post-stats {
            display: flex;
            gap: 1rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-message {
            text-align: center;
            padding: 2rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .login-message {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            margin-top: 1rem;
        }

        .login-message a {
            color: #4CAF50;
            text-decoration: none;
        }

        .login-message a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="join.html">åŠ å…¥æœåŠ¡å™¨</a></li>
                <li><a href="about.html">æœåŠ¡å™¨è§„åˆ™</a></li>
                <li><a href="forum.html">è®ºå›</a></li>
                <li><a href="donate.html">èµåŠ©æˆ‘ä»¬</a></li>
                <li><a href="contact.html">è”ç³»æ–¹å¼</a></li>
                <li><a href="login.html">ç™»å½•</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="section">
            <div class="forum-container">
                <div class="forum-header">
                    <h2>æœåŠ¡å™¨è®ºå›</h2>
                    <a href="new-post.html" class="new-post-btn" id="newPostBtn">å‘å¸ƒæ–°å¸–</a>
                </div>

                <div class="forum-categories">
                    <div class="category-card" data-category="announcement">
                        <h3>å…¬å‘Šé€šçŸ¥</h3>
                        <p>æœåŠ¡å™¨é‡è¦å…¬å‘Šå’Œæ›´æ–°ä¿¡æ¯</p>
                    </div>
                    <div class="category-card" data-category="discussion">
                        <h3>ç©å®¶äº¤æµ</h3>
                        <p>åˆ†äº«æ¸¸æˆç»éªŒå’Œäº¤æµå¿ƒå¾—</p>
                    </div>
                    <div class="category-card" data-category="showcase">
                        <h3>å»ºç­‘å±•ç¤º</h3>
                        <p>å±•ç¤ºä½ çš„ç²¾ç¾å»ºç­‘ä½œå“</p>
                    </div>
                    <div class="category-card" data-category="help">
                        <h3>é—®é¢˜åé¦ˆ</h3>
                        <p>åé¦ˆé—®é¢˜å’Œå¯»æ±‚å¸®åŠ©</p>
                    </div>
                </div>

                <div class="post-list" id="postList">
                    <!-- å¸–å­åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    <div class="empty-message">åŠ è½½ä¸­...</div>
                </div>

                <div class="login-message" id="loginMessage" style="display: none;">
                    éœ€è¦ <a href="login.html">ç™»å½•</a> åæ‰èƒ½å‘å¸–å’Œå›å¤
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Â© 2024 æˆ‘çš„ä¸–ç•ŒæœåŠ¡å™¨. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>

    <script>
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
        const token = localStorage.getItem('token');
        const newPostBtn = document.getElementById('newPostBtn');
        const loginMessage = document.getElementById('loginMessage');

        if (!token) {
            newPostBtn.style.display = 'none';
            loginMessage.style.display = 'block';
        }

        // åŠ è½½å¸–å­åˆ—è¡¨
        function loadPosts(category = '') {
            const postList = document.getElementById('postList');
            
            fetch('/api/posts' + (category ? `?category=${category}` : ''), {
                headers: token ? {
                    'Authorization': `Bearer ${token}`
                } : {}
            })
            .then(response => response.json())
            .then(posts => {
                if (posts.length === 0) {
                    postList.innerHTML = '<div class="empty-message">æš‚æ— å¸–å­</div>';
                    return;
                }

                postList.innerHTML = posts.map(post => `
                    <div class="post-item">
                        <div class="post-info">
                            <a href="post.html?id=${post._id}" class="post-title">${post.title}</a>
                            <div class="post-meta">
                                <span>ä½œè€…: ${post.author.username}</span> â€¢ 
                                <span>å‘å¸ƒäº: ${new Date(post.createdAt).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="post-stats">
                            <span>ğŸ‘ï¸ ${post.views}</span>
                            <span>ğŸ’¬ ${post.comments.length}</span>
                        </div>
                    </div>
                `).join('');
            })
            .catch(error => {
                console.error('åŠ è½½å¸–å­å¤±è´¥:', error);
                postList.innerHTML = '<div class="empty-message">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
            });
        }

        // åˆ†ç±»ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', () => {
                const category = card.dataset.category;
                loadPosts(category);
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.category-card').forEach(c => {
                    c.style.background = 'rgba(255, 255, 255, 0.05)';
                });
                card.style.background = 'rgba(255, 255, 255, 0.1)';
            });
        });

        // åˆå§‹åŠ è½½æ‰€æœ‰å¸–å­
        loadPosts();
    </script>
</body>
</html> 